!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return e(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}(self.webpackChunkaccounts=self.webpackChunkaccounts||[]).push([[878],{60878:function(e,a,n){"use strict";n.r(a),n.d(a,{TerminalReportModule:function(){return V}});var o=n(61116),l=n(33464),d=n(65724),c=n(22501),s=n.n(c),u=n(35366),p=n(55959),m=n(31225),g=n(529),f=n(47727),h=n(44019),Z=n(42693),b=n(78035),T=n(4612),A=function(){var e=function(){function e(t,a,i){r(this,e),this.http=t,this.errorService=a,this.authService=i,this.BASE_API_URL=g.N.BASE_API_URL,this.barcodeReportRecords=[],this.terminalSaleRRecords=[],this.userData=JSON.parse(localStorage.getItem("user")),this.barcodeReportRecordsSubject=new p.xQ,this.terminalSaleRecordsSubject=new p.xQ}return i(e,[{key:"terminalListListener",value:function(){return this.barcodeReportRecordsSubject.asObservable()}},{key:"terminalSaleListListener",value:function(){return this.terminalSaleRecordsSubject.asObservable()}},{key:"cancelTicket",value:function(e){var r=this;return this.http.post(this.BASE_API_URL+"/cancelTicket",{play_master_id:e}).pipe((0,f.K)(this.handleError),(0,h.b)(function(e){if(e.data){r.authService.updateUserBalance(e.point);var a=r.barcodeReportRecords.findIndex(function(t){return t.play_master_id===e.id});r.barcodeReportRecords[a].is_cancelled=1,r.barcodeReportRecordsSubject.next(t(r.barcodeReportRecords))}}))}},{key:"claimPrize",value:function(e){var r=this;return this.http.post(this.BASE_API_URL+"/claimPrize",{play_master_id:e}).pipe((0,f.K)(this.handleError),(0,h.b)(function(e){if(e.point){r.authService.updateUserBalance(e.point);var a=r.barcodeReportRecords.findIndex(function(t){return t.play_master_id===e.id});r.barcodeReportRecords[a].is_claimed=1,r.barcodeReportRecords[a].is_cancelled=1,r.barcodeReportRecordsSubject.next(t(r.barcodeReportRecords))}}))}},{key:"getTerminalReport",value:function(e,r,a){var i=this;return this.http.post(this.BASE_API_URL+"/terminal/barcodeReport",{terminalId:e,startDate:r,endDate:a}).pipe((0,f.K)(this.handleError),(0,h.b)(function(e){e.data&&(i.barcodeReportRecords=e.data,i.barcodeReportRecordsSubject.next(t(i.barcodeReportRecords)))}))}},{key:"getTerminalSaleReport",value:function(e,r,a){var i=this;return this.http.post(this.BASE_API_URL+"/terminal/terminal_sale_reports",{terminalId:e,startDate:r,endDate:a}).pipe((0,f.K)(this.handleError),(0,h.b)(function(e){e.data&&(i.terminalSaleRRecords=e.data,i.terminalSaleRecordsSubject.next(t(i.terminalSaleRRecords)))}))}},{key:"serverError",value:function(t){return t instanceof Response?(0,m._)("backend server error"):(0,m._)(0===t.status?{status:t.status,message:"Backend Server is not Working",statusText:t.statusText}:401===t.status?{status:t.status,message:"Your are not authorised",statusText:t.statusText}:t)}},{key:"handleError",value:function(t){return t.error.message.includes("1062")?(0,m._)("Record already exists"):(0,m._)(t.error.message)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(u.LFG(Z.eN),u.LFG(b.T),u.LFG(T.e))},e.\u0275prov=u.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),q=n(84772),v=n(57173),_=n(13070),y=n(9550),x=n(69024),S=n(31041),R=n(84369),k=n(59241),D=n(48158),U=n(47217);function w(t,e){if(1&t&&(u.TgZ(0,"tr"),u.TgZ(1,"td"),u._uU(2),u.qZA(),u.TgZ(3,"td"),u._uU(4),u.qZA(),u.TgZ(5,"td"),u._uU(6),u.qZA(),u.TgZ(7,"td"),u._uU(8),u.qZA(),u.TgZ(9,"td"),u._uU(10),u.qZA(),u.qZA()),2&t){var r=e.$implicit;u.xp6(2),u.Oqu(r.date),u.xp6(2),u.Oqu(r.total),u.xp6(2),u.Oqu(r.commission),u.xp6(2),u.Oqu(r.prize_value),u.xp6(2),u.Oqu(r.total-r.commission-r.prize_value)}}function J(t,e){1&t&&(u.TgZ(0,"div",29),u.TgZ(1,"h1"),u._uU(2,"No Data"),u.qZA(),u.qZA())}function M(t,e){if(1&t){var r=u.EpF();u.TgZ(0,"tr"),u.TgZ(1,"td"),u._uU(2),u.qZA(),u.TgZ(3,"td"),u._uU(4),u.qZA(),u.TgZ(5,"td"),u._uU(6),u.qZA(),u.TgZ(7,"td"),u._uU(8),u.qZA(),u.TgZ(9,"td"),u._uU(10),u.qZA(),u.TgZ(11,"td"),u._uU(12),u.qZA(),u.TgZ(13,"td"),u._uU(14),u.qZA(),u.TgZ(15,"td"),u.TgZ(16,"button",30),u.NdJ("click",function(){var t=u.CHM(r).$implicit;return u.oxw().claimPrize(t.play_master_id)}),u._uU(17),u.qZA(),u.qZA(),u.TgZ(18,"td"),u.TgZ(19,"button",31),u.NdJ("click",function(){var t=u.CHM(r).$implicit;return u.oxw().cancelTicket(t.play_master_id)}),u._uU(20,"Cancel"),u.qZA(),u.qZA(),u.TgZ(21,"td"),u.TgZ(22,"a",32),u.NdJ("click",function(){var t=u.CHM(r).$implicit,e=u.oxw();return u.MAs(85).show(),e.openPopup(t.play_master_id,t.barcode_number)}),u._UZ(23,"i",33),u.qZA(),u.qZA(),u.qZA()}if(2&t){var a=e.$implicit,i=e.index,n=u.oxw();u.xp6(2),u.Oqu(i+1),u.xp6(2),u.Oqu(a.draw_time),u.xp6(2),u.Oqu(a.ticket_taken_time),u.xp6(2),u.Oqu(a.barcode_number),u.xp6(2),u.Oqu(a.total_quantity),u.xp6(2),u.Oqu(a.amount),u.xp6(2),u.Oqu(a.prize_value),u.xp6(2),u.Q6J("hidden",0==a.prize_value)("disabled",1==a.is_claimed),u.xp6(1),u.Oqu(a.prize_value>0?a.is_claimed>0?"Claimed":"Claim":"No Prize"),u.xp6(2),u.Q6J("disabled",n.checkBtnEligibility(a))}}function F(t,e){1&t&&(u.TgZ(0,"div",29),u.TgZ(1,"h1"),u._uU(2,"No Data"),u.qZA(),u.qZA())}function O(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"Single"),u.qZA())}function C(t,e){if(1&t&&(u.TgZ(0,"button",46),u._uU(1),u.qZA()),2&t){var r=e.$implicit;u.s9C("matBadge",r.quantity),u.xp6(1),u.Oqu(r.single_number)}}function N(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"Triple"),u.qZA())}function E(t,e){if(1&t&&(u.TgZ(0,"div",48),u.TgZ(1,"button",49),u._uU(2),u.qZA(),u.qZA()),2&t){var r=e.$implicit;u.xp6(1),u.s9C("matBadge",r.quantity),u.Q6J("matBadgeHidden",!1),u.xp6(1),u.hij(" ",r.visible_triple_number," ")}}function B(t,e){if(1&t&&(u.TgZ(0,"div",42),u.YNc(1,E,3,3,"div",47),u.qZA()),2&t){var r=e.index,a=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",a.barcodeDetails.triple.slice(10*r,10*r+10))}}function Q(t,e){if(1&t){var r=u.EpF();u.TgZ(0,"div",34),u.TgZ(1,"div",35),u.TgZ(2,"div",36),u.TgZ(3,"h4",37),u._uU(4),u.qZA(),u.TgZ(5,"button",38),u.NdJ("click",function(){return u.CHM(r),u.oxw(),u.MAs(85).hide()}),u.TgZ(6,"span",39),u._uU(7,"\xd7"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(8,"div",40),u.YNc(9,O,2,0,"span",41),u.TgZ(10,"div",42),u.YNc(11,C,2,2,"button",43),u.qZA(),u.YNc(12,N,2,0,"span",41),u.YNc(13,B,2,1,"div",44),u.qZA(),u._UZ(14,"div",45),u.qZA(),u.qZA()}if(2&t){var a=u.oxw();u.xp6(4),u.hij(" Ticket: ",a.barcodeDetails.barcode," "),u.xp6(5),u.Q6J("ngIf",a.barcodeDetails.single.length),u.xp6(2),u.Q6J("ngForOf",a.barcodeDetails.single),u.xp6(1),u.Q6J("ngIf",a.barcodeDetails.triple.length),u.xp6(1),u.Q6J("ngForOf",a.barcodeDetails.triple.slice(0,a.barcodeDetails.triple.length%10==0?a.barcodeDetails.triple.length/10:a.barcodeDetails.triple.length/10+1))}}var I,P,L=[{path:"",canActivate:[d.v],component:(I=function(){function t(e,a,i){var n=this;r(this,t),this.renderer=e,this.terminalReportService=a,this.adminReportService=i,this.thisYear=(new Date).getFullYear(),this.thisMonth=(new Date).getMonth(),this.thisDay=(new Date).getDate(),this.startDate=new Date(this.thisYear,this.thisMonth,this.thisDay),this.StartDateFilter=this.startDate,this.EndDateFilter=this.startDate,this.pipe=new o.uU("en-US"),this.terminalReportData=[],this.terminalSaleReportData=[],this.renderer.setStyle(document.body,"background-image","none"),this.terminalReportService.terminalListListener().subscribe(function(t){n.terminalReportData=t,console.log(n.terminalReportData)}),this.terminalReportService.terminalSaleListListener().subscribe(function(t){n.terminalSaleReportData=t,console.log(n.terminalSaleReportData)}),this.getTerminalBarcodeReport(),this.getTerminalSaleReport()}return i(t,[{key:"ngOnInit",value:function(){}},{key:"claimPrize",value:function(t){s().fire({title:"Please Wait !",html:"adding points ...",allowOutsideClick:!1,didOpen:function(){s().showLoading()}}),this.terminalReportService.claimPrize(t).subscribe(function(t){t.point&&s().close()})}},{key:"checkBtnEligibility",value:function(t){return 1==t.is_cancelled||0==t.is_cancelable}},{key:"cancelTicket",value:function(t){var e=this;s().fire({title:"Confirm Cancel ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, confirm"}).then(function(r){r.isConfirmed?(s().fire({title:"Please Wait !",html:"Confirming cancel",allowOutsideClick:!1,didOpen:function(){s().showLoading()}}),e.terminalReportService.cancelTicket(t).subscribe(function(t){t.data?(s().hideLoading(),s().fire({icon:"success",title:"Cancelled",showConfirmButton:!1,timer:1500})):s().fire({icon:"error",title:"Some error occurred",showConfirmButton:!1,timer:2e3})})):r.isDenied&&s().fire("Changes are not saved","","info")})}},{key:"getTerminalBarcodeReport",value:function(){s().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:function(){s().showLoading()}});var t=JSON.parse(localStorage.getItem("user")),e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalReport(t.userId,e,r).subscribe(function(t){t.data&&s().close()})}},{key:"getTerminalSaleReport",value:function(){s().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:function(){s().showLoading()}});var t=JSON.parse(localStorage.getItem("user")),e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalSaleReport(t.userId,e,r).subscribe(function(t){t.data&&s().close()})}},{key:"openPopup",value:function(t,e){var r=this;this.adminReportService.getBarcodeDetails(t).subscribe(function(t){r.barcodeDetails=t.data})}}]),t}(),I.\u0275fac=function(t){return new(t||I)(u.Y36(u.Qsj),u.Y36(A),u.Y36(q.Q))},I.\u0275cmp=u.Xpm({type:I,selectors:[["app-terminal-report"]],decls:87,vars:21,consts:[[1,"mt-2","mr-3","ml-3"],["label","Terminal sale report"],[1,"pt-1","d-flex"],[1,"col-3"],["appearance","fill"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],[3,"ngModel","ngModelChange"],["picker",""],["picker1",""],["mat-button","","color","accent",2,"font-size","20px",3,"click"],["matSort","",1,"table","table-bordered","table-sm",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","total"],["mat-sort-header","commission"],["mat-sort-header","prize_value"],["mat-sort-header","ntp"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["label","Terminal barcode report"],[1,"",2,"overflow","hidden"],["matSort","",1,"table","table-bordered","table-sm","m-3",2,"border","none !important","height","50px","overflow","hidden"],["mat-sort-header","draw_time"],["mat-sort-header","ticket_taken_time"],["mat-sort-header","barcode_number"],["mat-sort-header","total_quantity"],["mat-sort-header","amount"],["mdbModal","","id","frameModalTop","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade","top",2,"overflow-y","auto"],["frame","mdbModal"],["class","modal-dialog modal-notify modal-info","role","document","style","min-width: 550px",4,"ngIf"],[1,"text-center"],["type","button",1,"btn","btn-danger",2,"min-width","87px",3,"hidden","disabled","click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],["color","info","mdbWavesEffect","",1,"waves-effect","mb-4",3,"click"],[1,"bi","bi-info-square-fill"],["role","document",1,"modal-dialog","modal-notify","modal-info",2,"min-width","550px"],[1,"modal-content"],[1,"modal-header","text-center"],[1,"modal-title","white-text","font-weight-bold"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true",1,"white-text"],[1,"modal-body"],[4,"ngIf"],[1,"d-flex","flex-row","mt-2"],["class","mr-2",3,"matBadge",4,"ngFor","ngForOf"],["class","d-flex flex-row mt-2",4,"ngFor","ngForOf"],[1,"modal-footer","justify-content-center"],[1,"mr-2",3,"matBadge"],["colspan","2","class","text-center align-middle mr-3","style","max-width: 100% !important;",4,"ngFor","ngForOf"],["colspan","2",1,"text-center","align-middle","mr-3",2,"max-width","100% !important"],["mat-raised-button","","value","bold","name","fontStyle","aria-label","Font Style",2,"font-size","larger","min-width","97% !important","padding","0px !important","min-height","40px",3,"matBadge","matBadgeHidden"]],template:function(t,e){if(1&t&&(u.TgZ(0,"mat-tab-group",0),u.TgZ(1,"mat-tab",1),u.TgZ(2,"div",2),u.TgZ(3,"div",3),u.TgZ(4,"mat-form-field",4),u.TgZ(5,"mat-label"),u._uU(6,"Start date"),u.qZA(),u.TgZ(7,"input",5),u.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),u.qZA(),u._UZ(8,"mat-datepicker-toggle",6),u.TgZ(9,"mat-datepicker",7,8),u.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(11,"div",3),u.TgZ(12,"mat-form-field",4),u.TgZ(13,"mat-label"),u._uU(14,"End date"),u.qZA(),u.TgZ(15,"input",5),u.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),u.qZA(),u._UZ(16,"mat-datepicker-toggle",6),u.TgZ(17,"mat-datepicker",7,9),u.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(19,"button",10),u.NdJ("click",function(){return e.getTerminalSaleReport()}),u._uU(20,"Search"),u.qZA(),u.qZA(),u.TgZ(21,"table",11),u.TgZ(22,"thead"),u.TgZ(23,"tr"),u.TgZ(24,"th"),u._uU(25,"Date"),u.qZA(),u.TgZ(26,"th",12),u._uU(27,"Amount"),u.qZA(),u.TgZ(28,"th",13),u._uU(29,"Commission"),u.qZA(),u.TgZ(30,"th",14),u._uU(31,"Prize"),u.qZA(),u.TgZ(32,"th",15),u._uU(33,"NTP"),u.qZA(),u._UZ(34,"th"),u.qZA(),u.qZA(),u.TgZ(35,"tbody"),u.YNc(36,w,11,5,"tr",16),u.qZA(),u.qZA(),u.YNc(37,J,3,0,"div",17),u.qZA(),u.TgZ(38,"mat-tab",18),u.TgZ(39,"div",2),u.TgZ(40,"div",3),u.TgZ(41,"mat-form-field",4),u.TgZ(42,"mat-label"),u._uU(43,"Start date"),u.qZA(),u.TgZ(44,"input",5),u.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),u.qZA(),u._UZ(45,"mat-datepicker-toggle",6),u.TgZ(46,"mat-datepicker",7,8),u.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(48,"div",3),u.TgZ(49,"mat-form-field",4),u.TgZ(50,"mat-label"),u._uU(51,"End date"),u.qZA(),u.TgZ(52,"input",5),u.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),u.qZA(),u._UZ(53,"mat-datepicker-toggle",6),u.TgZ(54,"mat-datepicker",7,9),u.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(56,"button",10),u.NdJ("click",function(){return e.getTerminalBarcodeReport()}),u._uU(57,"Search"),u.qZA(),u.qZA(),u.TgZ(58,"div",19),u.TgZ(59,"table",20),u.TgZ(60,"thead"),u.TgZ(61,"tr"),u.TgZ(62,"th"),u._uU(63,"Sl.NO"),u.qZA(),u.TgZ(64,"th",21),u._uU(65,"Draw Time"),u.qZA(),u.TgZ(66,"th",22),u._uU(67,"Ticket Time"),u.qZA(),u.TgZ(68,"th",23),u._uU(69,"Barcode"),u.qZA(),u.TgZ(70,"th",24),u._uU(71,"Quantity"),u.qZA(),u.TgZ(72,"th",25),u._uU(73,"Amount"),u.qZA(),u.TgZ(74,"th",14),u._uU(75,"Prize"),u.qZA(),u.TgZ(76,"th"),u._uU(77,"Claim"),u.qZA(),u.TgZ(78,"th"),u._uU(79,"Cancel"),u.qZA(),u._UZ(80,"th"),u.qZA(),u.qZA(),u.TgZ(81,"tbody"),u.YNc(82,M,24,11,"tr",16),u.qZA(),u.qZA(),u.YNc(83,F,3,0,"div",17),u.qZA(),u.qZA(),u.qZA(),u.TgZ(84,"div",26,27),u.YNc(86,Q,15,5,"div",28),u.qZA()),2&t){var r=u.MAs(10),a=u.MAs(18);u.xp6(7),u.Q6J("matDatepicker",r)("ngModel",e.StartDateFilter),u.xp6(1),u.Q6J("for",r),u.xp6(1),u.Q6J("ngModel",e.StartDateFilter),u.xp6(6),u.Q6J("matDatepicker",a)("ngModel",e.EndDateFilter),u.xp6(1),u.Q6J("for",a),u.xp6(1),u.Q6J("ngModel",e.EndDateFilter),u.xp6(19),u.Q6J("ngForOf",e.terminalSaleReportData),u.xp6(1),u.Q6J("ngIf",0==e.terminalSaleReportData.length),u.xp6(7),u.Q6J("matDatepicker",r)("ngModel",e.StartDateFilter),u.xp6(1),u.Q6J("for",r),u.xp6(1),u.Q6J("ngModel",e.StartDateFilter),u.xp6(6),u.Q6J("matDatepicker",a)("ngModel",e.EndDateFilter),u.xp6(1),u.Q6J("for",a),u.xp6(1),u.Q6J("ngModel",e.EndDateFilter),u.xp6(28),u.Q6J("ngForOf",e.terminalReportData),u.xp6(1),u.Q6J("ngIf",0==e.terminalReportData.length),u.xp6(3),u.Q6J("ngIf",e.barcodeDetails)}},directives:[v.SP,v.uX,_.KE,_.hX,y.Nt,x.hl,S.Fj,S.JJ,S.On,x.nW,_.R9,x.Mq,R.lW,k.YE,k.nU,o.sg,o.O5,D.oB,D.b6,U.k],styles:[""]}),I)}],z=function(){var t=function t(){r(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[l.Bz.forChild(L)],l.Bz]}),t}(),Y=n(35994),j=n(1887),W=n(77154),$=n(22797),H=n(79572),K=n(97624),X=n(4333),G=n(87064),V=((P=function t(){r(this,t)}).\u0275fac=function(t){return new(t||P)},P.\u0275mod=u.oAB({type:P}),P.\u0275inj=u.cJS({imports:[[o.ez,z,o.ez,Y.q,v.Nh,j.q,W.o9,$.QW,S.u5,S.UX,H.rP,k.JX,K.aE,K.bz,D.At,X.UU,U.g,x.FA,y.c,S.u5,G.XK,G.si]]}),P)}}])}();