(self.webpackChunkaccounts=self.webpackChunkaccounts||[]).push([[878],{60878:function(t,e,r){"use strict";r.r(e),r.d(e,{TerminalReportModule:function(){return B}});var a=r(61116),i=r(33464),n=r(65724),o=r(22501),s=r.n(o),l=r(35366),c=r(55959),d=r(31225),u=r(529),p=r(47727),g=r(44019),h=r(42693),m=r(78035),Z=r(4612);let T=(()=>{class t{constructor(t,e,r){this.http=t,this.errorService=e,this.authService=r,this.BASE_API_URL=u.N.BASE_API_URL,this.barcodeReportRecords=[],this.terminalSaleRRecords=[],this.userData=JSON.parse(localStorage.getItem("user")),this.barcodeReportRecordsSubject=new c.xQ,this.terminalSaleRecordsSubject=new c.xQ}terminalListListener(){return this.barcodeReportRecordsSubject.asObservable()}terminalSaleListListener(){return this.terminalSaleRecordsSubject.asObservable()}cancelTicket(t){return this.http.post(this.BASE_API_URL+"/cancelTicket",{play_master_id:t}).pipe((0,p.K)(this.handleError),(0,g.b)(t=>{if(t.data){this.authService.updateUserBalance(t.point),console.log(t.point);const e=this.barcodeReportRecords.findIndex(e=>e.play_master_id===t.id);this.barcodeReportRecords[e].is_cancelled=1,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords])}}))}getTerminalReport(t,e,r){return this.http.post(this.BASE_API_URL+"/terminal/barcodeReport",{terminalId:t,startDate:e,endDate:r}).pipe((0,p.K)(this.handleError),(0,g.b)(t=>{t.data&&(this.barcodeReportRecords=t.data,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords]))}))}getTerminalSaleReport(t,e,r){return this.http.post(this.BASE_API_URL+"/terminal/terminal_sale_reports",{terminalId:t,startDate:e,endDate:r}).pipe((0,p.K)(this.handleError),(0,g.b)(t=>{t.data&&(this.terminalSaleRRecords=t.data,this.terminalSaleRecordsSubject.next([...this.terminalSaleRRecords]))}))}serverError(t){return t instanceof Response?(0,d._)("backend server error"):(0,d._)(0===t.status?{status:t.status,message:"Backend Server is not Working",statusText:t.statusText}:401===t.status?{status:t.status,message:"Your are not authorised",statusText:t.statusText}:t)}handleError(t){return t.error.message.includes("1062")?(0,d._)("Record already exists"):(0,d._)(t.error.message)}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(h.eN),l.LFG(m.T),l.LFG(Z.e))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var A=r(57173),q=r(13070),b=r(9550),f=r(69024),_=r(31041),S=r(84369),R=r(59241);function D(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"tr"),l.TgZ(1,"td"),l._uU(2),l.qZA(),l.TgZ(3,"td"),l._uU(4),l.qZA(),l.TgZ(5,"td"),l._uU(6),l.qZA(),l.TgZ(7,"td"),l._uU(8),l.qZA(),l.TgZ(9,"td"),l._uU(10),l.qZA(),l.TgZ(11,"td"),l.TgZ(12,"button",22),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().cancelTicket(e.play_master_id)}),l._uU(13,"Cancel"),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,r=l.oxw();l.xp6(2),l.Oqu(t.barcode_number),l.xp6(2),l.Oqu(t.draw_time),l.xp6(2),l.Oqu(t.total_quantity),l.xp6(2),l.Oqu(t.amount),l.xp6(2),l.Oqu(t.prize_value),l.xp6(2),l.Q6J("disabled",r.checkBtnEligibility(t))}}function U(t,e){if(1&t&&(l.TgZ(0,"tr"),l.TgZ(1,"td"),l._uU(2),l.qZA(),l.TgZ(3,"td"),l._uU(4),l.qZA(),l.TgZ(5,"td"),l._uU(6),l.qZA(),l.TgZ(7,"td"),l._uU(8),l.qZA(),l.TgZ(9,"td"),l._uU(10),l.qZA(),l.TgZ(11,"td"),l._uU(12),l.qZA(),l.qZA()),2&t){const t=e.$implicit;l.xp6(2),l.Oqu(t.terminal_pin),l.xp6(2),l.Oqu(t.stokiest_name),l.xp6(2),l.Oqu(t.total),l.xp6(2),l.Oqu(t.commission),l.xp6(2),l.Oqu(t.prize_value),l.xp6(2),l.Oqu(t.ntp.toFixed(2))}}const x=[{path:"",canActivate:[n.v],component:(()=>{class t{constructor(t,e){this.renderer=t,this.terminalReportService=e,this.thisYear=(new Date).getFullYear(),this.thisMonth=(new Date).getMonth(),this.thisDay=(new Date).getDate(),this.startDate=new Date(this.thisYear,this.thisMonth,this.thisDay),this.StartDateFilter=this.startDate,this.EndDateFilter=this.startDate,this.pipe=new a.uU("en-US"),this.renderer.setStyle(document.body,"background-image","none"),this.terminalReportService.terminalListListener().subscribe(t=>{this.terminalReportData=t,console.log(this.terminalReportData)}),this.terminalReportService.terminalSaleListListener().subscribe(t=>{this.terminalSaleReportData=t}),this.getTerminalBarcodeReport(),this.getTerminalSaleReport()}ngOnInit(){}checkBtnEligibility(t){return 1==t.is_cancelled||0==t.is_cancelable}cancelTicket(t){s().fire({title:"Confirm Cancel ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, confirm"}).then(e=>{e.isConfirmed?(s().fire({title:"Please Wait !",html:"Confirming cancel",allowOutsideClick:!1,didOpen:()=>{s().showLoading()}}),this.terminalReportService.cancelTicket(t).subscribe(t=>{t.data?(s().hideLoading(),s().fire({icon:"success",title:"Cancelled",showConfirmButton:!1,timer:1500})):s().fire({icon:"error",title:"Some error occurred",showConfirmButton:!1,timer:2e3})})):e.isDenied&&s().fire("Changes are not saved","","info")})}getTerminalBarcodeReport(){s().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{s().showLoading()}});const t=JSON.parse(localStorage.getItem("user"));var e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalReport(t.userId,e,r).subscribe(t=>{t.data&&s().close()})}getTerminalSaleReport(){s().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{s().showLoading()}});const t=JSON.parse(localStorage.getItem("user"));var e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalSaleReport(t.userId,e,r).subscribe(t=>{t.data&&s().close()})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.Qsj),l.Y36(T))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-terminal-report"]],decls:81,vars:18,consts:[[1,"mt-2","mr-3","ml-3"],["label","Terminal barcode report"],[1,"pt-1","d-flex"],[1,"col-3"],["appearance","fill"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],[3,"ngModel","ngModelChange"],["picker",""],["picker1",""],["mat-button","","color","accent",2,"font-size","20px",3,"click"],[1,""],["matSort","",1,"table","table-bordered","table-sm","m-3",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","terminal_pin"],["mat-sort-header","total"],["mat-sort-header","prize_value"],[4,"ngFor","ngForOf"],["label","Terminal sale report"],["matSort","",1,"table","table-bordered","table-sm",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","commission"],["mat-sort-header","ntp"],[3,"show"],["type","button",1,"btn","btn-danger",3,"disabled","click"]],template:function(t,e){if(1&t&&(l.TgZ(0,"mat-tab-group",0),l.TgZ(1,"mat-tab",1),l.TgZ(2,"div",2),l.TgZ(3,"div",3),l.TgZ(4,"mat-form-field",4),l.TgZ(5,"mat-label"),l._uU(6,"Start date"),l.qZA(),l.TgZ(7,"input",5),l.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),l.qZA(),l._UZ(8,"mat-datepicker-toggle",6),l.TgZ(9,"mat-datepicker",7,8),l.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"div",3),l.TgZ(12,"mat-form-field",4),l.TgZ(13,"mat-label"),l._uU(14,"End date"),l.qZA(),l.TgZ(15,"input",5),l.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),l.qZA(),l._UZ(16,"mat-datepicker-toggle",6),l.TgZ(17,"mat-datepicker",7,9),l.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"button",10),l.NdJ("click",function(){return e.getTerminalBarcodeReport()}),l._uU(20,"Search"),l.qZA(),l.qZA(),l.TgZ(21,"div",11),l.TgZ(22,"table",12),l.TgZ(23,"thead"),l.TgZ(24,"tr"),l.TgZ(25,"th",13),l._uU(26,"Baarcode"),l.qZA(),l.TgZ(27,"th",13),l._uU(28,"Draw Time"),l.qZA(),l.TgZ(29,"th",13),l._uU(30,"Quantity"),l.qZA(),l.TgZ(31,"th",14),l._uU(32,"Amount"),l.qZA(),l.TgZ(33,"th",15),l._uU(34,"Prize"),l.qZA(),l.TgZ(35,"th",15),l._uU(36,"Cancel"),l.qZA(),l._UZ(37,"th"),l.qZA(),l.qZA(),l.TgZ(38,"tbody"),l.YNc(39,D,14,6,"tr",16),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(40,"mat-tab",17),l.TgZ(41,"div",2),l.TgZ(42,"div",3),l.TgZ(43,"mat-form-field",4),l.TgZ(44,"mat-label"),l._uU(45,"Start date"),l.qZA(),l.TgZ(46,"input",5),l.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),l.qZA(),l._UZ(47,"mat-datepicker-toggle",6),l.TgZ(48,"mat-datepicker",7,8),l.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(50,"div",3),l.TgZ(51,"mat-form-field",4),l.TgZ(52,"mat-label"),l._uU(53,"End date"),l.qZA(),l.TgZ(54,"input",5),l.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),l.qZA(),l._UZ(55,"mat-datepicker-toggle",6),l.TgZ(56,"mat-datepicker",7,9),l.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(58,"button",10),l.NdJ("click",function(){return e.getTerminalSaleReport()}),l._uU(59,"Search"),l.qZA(),l.qZA(),l.TgZ(60,"table",18),l.TgZ(61,"thead"),l.TgZ(62,"tr"),l.TgZ(63,"th"),l._uU(64,"Terminal Id"),l.qZA(),l.TgZ(65,"th",13),l._uU(66,"Stokiest Name"),l.qZA(),l.TgZ(67,"th",14),l._uU(68,"Total"),l.qZA(),l.TgZ(69,"th",19),l._uU(70,"Commission"),l.qZA(),l.TgZ(71,"th",15),l._uU(72,"Prize"),l.qZA(),l.TgZ(73,"th",20),l._uU(74,"NTP"),l.qZA(),l._UZ(75,"th"),l.qZA(),l.qZA(),l.TgZ(76,"tbody"),l.YNc(77,U,13,6,"tr",16),l.qZA(),l.qZA(),l.TgZ(78,"div",21),l.NdJ("show",function(){return!e.terminalSaleReportData}),l.TgZ(79,"h1"),l._uU(80,"No Data"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t){const t=l.MAs(10),r=l.MAs(18);l.xp6(7),l.Q6J("matDatepicker",t)("ngModel",e.StartDateFilter),l.xp6(1),l.Q6J("for",t),l.xp6(1),l.Q6J("ngModel",e.StartDateFilter),l.xp6(6),l.Q6J("matDatepicker",r)("ngModel",e.EndDateFilter),l.xp6(1),l.Q6J("for",r),l.xp6(1),l.Q6J("ngModel",e.EndDateFilter),l.xp6(22),l.Q6J("ngForOf",e.terminalReportData),l.xp6(7),l.Q6J("matDatepicker",t)("ngModel",e.StartDateFilter),l.xp6(1),l.Q6J("for",t),l.xp6(1),l.Q6J("ngModel",e.StartDateFilter),l.xp6(6),l.Q6J("matDatepicker",r)("ngModel",e.EndDateFilter),l.xp6(1),l.Q6J("for",r),l.xp6(1),l.Q6J("ngModel",e.EndDateFilter),l.xp6(21),l.Q6J("ngForOf",e.terminalSaleReportData)}},directives:[A.SP,A.uX,q.KE,q.hX,b.Nt,f.hl,_.Fj,_.JJ,_.On,f.nW,q.R9,f.Mq,S.lW,R.YE,R.nU,a.sg],styles:[""]}),t})()}];let k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[i.Bz.forChild(x)],i.Bz]}),t})();var v=r(52030),y=r(1887),M=r(77154),J=r(22797),F=r(79572),w=r(97624),C=r(48158),E=r(4333),O=r(47217),N=r(87064);let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[a.ez,k,a.ez,v.q,A.Nh,y.q,M.o9,J.QW,_.u5,_.UX,F.rP,R.JX,w.aE,w.bz,C.At,E.UU,O.g,f.FA,b.c,_.u5,N.XK,N.si]]}),t})()}}]);