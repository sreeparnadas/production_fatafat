"use strict";(self.webpackChunkaccounts=self.webpackChunkaccounts||[]).push([[771],{8771:function(t,e,a){a.r(e),a.d(e,{TerminalReportModule:function(){return $}});var i=a(8583),r=a(3423),n=a(1982),o=a(8259),l=a.n(o),d=a(7716),s=a(9765),c=a(205),p=a(2340),u=a(5304),m=a(8307),g=a(1841),h=a(4889),Z=a(3535);let b=(()=>{class t{constructor(t,e,a){this.http=t,this.errorService=e,this.authService=a,this.BASE_API_URL=p.N.BASE_API_URL,this.barcodeReportRecords=[],this.terminalSaleRRecords=[],this.userData=JSON.parse(localStorage.getItem("user")),this.barcodeReportRecordsSubject=new s.xQ,this.terminalSaleRecordsSubject=new s.xQ}terminalListListener(){return this.barcodeReportRecordsSubject.asObservable()}terminalSaleListListener(){return this.terminalSaleRecordsSubject.asObservable()}cancelTicket(t){return this.http.post(this.BASE_API_URL+"/cancelTicket",{play_master_id:t}).pipe((0,u.K)(this.handleError),(0,m.b)(t=>{if(t.data){this.authService.updateUserBalance(t.point);const e=this.barcodeReportRecords.findIndex(e=>e.play_master_id===t.id);this.barcodeReportRecords[e].is_cancelled=1,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords])}}))}claimPrize(t){return this.http.post(this.BASE_API_URL+"/claimPrize",{play_master_id:t}).pipe((0,u.K)(this.handleError),(0,m.b)(t=>{if(t.point){this.authService.updateUserBalance(t.point);const e=this.barcodeReportRecords.findIndex(e=>e.play_master_id===t.id);this.barcodeReportRecords[e].is_claimed=1,this.barcodeReportRecords[e].is_cancelled=1,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords])}}))}getTerminalReport(t,e,a){return this.http.post(this.BASE_API_URL+"/terminal/barcodeReport",{terminalId:t,startDate:e,endDate:a}).pipe((0,u.K)(this.handleError),(0,m.b)(t=>{t.data&&(this.barcodeReportRecords=t.data,this.barcodeReportRecordsSubject.next([...this.barcodeReportRecords]))}))}getTerminalSaleReport(t,e,a){return this.http.post(this.BASE_API_URL+"/terminal/terminal_sale_reports",{terminalId:t,startDate:e,endDate:a}).pipe((0,u.K)(this.handleError),(0,m.b)(t=>{t.data&&(this.terminalSaleRRecords=t.data,this.terminalSaleRecordsSubject.next([...this.terminalSaleRRecords]))}))}serverError(t){return t instanceof Response?(0,c._)("backend server error"):(0,c._)(0===t.status?{status:t.status,message:"Backend Server is not Working",statusText:t.statusText}:401===t.status?{status:t.status,message:"Your are not authorised",statusText:t.statusText}:t)}handleError(t){return t.error.message.includes("1062")?(0,c._)("Record already exists"):(0,c._)(t.error.message)}}return t.\u0275fac=function(e){return new(e||t)(d.LFG(g.eN),d.LFG(h.T),d.LFG(Z.e))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=a(1140),T=a(5939),A=a(8295),q=a(9983),_=a(3220),x=a(3679),S=a(1095),R=a(1494),v=a(9925),D=a(346);function U(t,e){if(1&t&&(d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.qZA(),d.TgZ(3,"td"),d._uU(4),d.qZA(),d.TgZ(5,"td"),d._uU(6),d.qZA(),d.TgZ(7,"td"),d._uU(8),d.qZA(),d.TgZ(9,"td"),d._uU(10),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.xp6(2),d.Oqu(t.date),d.xp6(2),d.Oqu(t.total),d.xp6(2),d.Oqu(t.commission),d.xp6(2),d.Oqu(t.prize_value),d.xp6(2),d.Oqu(t.total-t.commission-t.prize_value)}}function y(t,e){1&t&&(d.TgZ(0,"div",29),d.TgZ(1,"h1"),d._uU(2,"No Data"),d.qZA(),d.qZA())}function k(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.qZA(),d.TgZ(3,"td"),d._uU(4),d.qZA(),d.TgZ(5,"td"),d._uU(6),d.qZA(),d.TgZ(7,"td"),d._uU(8),d.qZA(),d.TgZ(9,"td"),d._uU(10),d.qZA(),d.TgZ(11,"td"),d._uU(12),d.qZA(),d.TgZ(13,"td"),d._uU(14),d.qZA(),d.TgZ(15,"td"),d.TgZ(16,"button",30),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw().claimPrize(e.play_master_id)}),d._uU(17),d.qZA(),d.qZA(),d.TgZ(18,"td"),d.TgZ(19,"button",31),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw().cancelTicket(e.play_master_id)}),d._uU(20,"Cancel"),d.qZA(),d.qZA(),d.TgZ(21,"td"),d.TgZ(22,"a",32),d.NdJ("click",function(){const e=d.CHM(t).$implicit,a=d.oxw();return d.MAs(85).show(),a.openPopup(e.play_master_id,e.barcode_number)}),d._UZ(23,"i",33),d.qZA(),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit,a=e.index,i=d.oxw();d.xp6(2),d.Oqu(a+1),d.xp6(2),d.Oqu(t.draw_time),d.xp6(2),d.Oqu(t.ticket_taken_time),d.xp6(2),d.Oqu(t.barcode_number),d.xp6(2),d.Oqu(t.total_quantity),d.xp6(2),d.Oqu(t.amount),d.xp6(2),d.Oqu(t.prize_value),d.xp6(2),d.Q6J("hidden",0==t.prize_value)("disabled",1==t.is_claimed),d.xp6(1),d.Oqu(t.prize_value>0?t.is_claimed>0?"Claimed":"Claim":"No Prize"),d.xp6(2),d.Q6J("disabled",i.checkBtnEligibility(t))}}function w(t,e){1&t&&(d.TgZ(0,"div",29),d.TgZ(1,"h1"),d._uU(2,"No Data"),d.qZA(),d.qZA())}function J(t,e){1&t&&(d.TgZ(0,"span"),d._uU(1,"Single"),d.qZA())}function M(t,e){if(1&t&&(d.TgZ(0,"button",46),d._uU(1),d.qZA()),2&t){const t=e.$implicit;d.s9C("matBadge",t.quantity),d.xp6(1),d.Oqu(t.single_number)}}function F(t,e){1&t&&(d.TgZ(0,"span"),d._uU(1,"Triple"),d.qZA())}function O(t,e){if(1&t&&(d.TgZ(0,"div",48),d.TgZ(1,"button",49),d._uU(2),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.xp6(1),d.s9C("matBadge",t.quantity),d.Q6J("matBadgeHidden",!1),d.xp6(1),d.hij(" ",t.visible_triple_number," ")}}function C(t,e){if(1&t&&(d.TgZ(0,"div",42),d.YNc(1,O,3,3,"div",47),d.qZA()),2&t){const t=e.index,a=d.oxw(2);d.xp6(1),d.Q6J("ngForOf",a.barcodeDetails.triple.slice(10*t,10*t+10))}}function N(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"div",34),d.TgZ(1,"div",35),d.TgZ(2,"div",36),d.TgZ(3,"h4",37),d._uU(4),d.qZA(),d.TgZ(5,"button",38),d.NdJ("click",function(){return d.CHM(t),d.oxw(),d.MAs(85).hide()}),d.TgZ(6,"span",39),d._uU(7,"\xd7"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(8,"div",40),d.YNc(9,J,2,0,"span",41),d.TgZ(10,"div",42),d.YNc(11,M,2,2,"button",43),d.qZA(),d.YNc(12,F,2,0,"span",41),d.YNc(13,C,2,1,"div",44),d.qZA(),d._UZ(14,"div",45),d.qZA(),d.qZA()}if(2&t){const t=d.oxw();d.xp6(4),d.hij(" Ticket: ",t.barcodeDetails.barcode," "),d.xp6(5),d.Q6J("ngIf",t.barcodeDetails.single.length),d.xp6(2),d.Q6J("ngForOf",t.barcodeDetails.single),d.xp6(1),d.Q6J("ngIf",t.barcodeDetails.triple.length),d.xp6(1),d.Q6J("ngForOf",t.barcodeDetails.triple.slice(0,t.barcodeDetails.triple.length%10==0?t.barcodeDetails.triple.length/10:t.barcodeDetails.triple.length/10+1))}}const E=[{path:"",canActivate:[n.v],component:(()=>{class t{constructor(t,e,a){this.renderer=t,this.terminalReportService=e,this.adminReportService=a,this.thisYear=(new Date).getFullYear(),this.thisMonth=(new Date).getMonth(),this.thisDay=(new Date).getDate(),this.startDate=new Date(this.thisYear,this.thisMonth,this.thisDay),this.StartDateFilter=this.startDate,this.EndDateFilter=this.startDate,this.pipe=new i.uU("en-US"),this.terminalReportData=[],this.terminalSaleReportData=[],this.renderer.setStyle(document.body,"background-image","none"),this.terminalReportService.terminalListListener().subscribe(t=>{this.terminalReportData=t}),this.terminalReportService.terminalSaleListListener().subscribe(t=>{this.terminalSaleReportData=t}),this.getTerminalBarcodeReport(),this.getTerminalSaleReport()}ngOnInit(){}claimPrize(t){l().fire({title:"Please Wait !",html:"adding points ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}}),this.terminalReportService.claimPrize(t).subscribe(t=>{t.point&&l().close()})}checkBtnEligibility(t){return 1==t.is_cancelled||0==t.is_cancelable}cancelTicket(t){l().fire({title:"Confirm Cancel ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, confirm"}).then(e=>{e.isConfirmed?(l().fire({title:"Please Wait !",html:"Confirming cancel",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}}),this.terminalReportService.cancelTicket(t).subscribe(t=>{t.data?(l().hideLoading(),l().fire({icon:"success",title:"Cancelled",showConfirmButton:!1,timer:1500})):l().fire({icon:"error",title:"Some error occurred",showConfirmButton:!1,timer:2e3})})):e.isDenied&&l().fire("Changes are not saved","","info")})}getTerminalBarcodeReport(){l().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}});const t=JSON.parse(localStorage.getItem("user"));var e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),a=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalReport(t.userId,e,a).subscribe(t=>{t.data&&l().close()})}getTerminalSaleReport(){l().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:()=>{l().showLoading()}});const t=JSON.parse(localStorage.getItem("user"));var e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),a=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalSaleReport(t.userId,e,a).subscribe(t=>{t.data&&l().close()})}openPopup(t,e){this.adminReportService.getBarcodeDetails(t).subscribe(t=>{this.barcodeDetails=t.data})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(d.Qsj),d.Y36(b),d.Y36(f.Q))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-terminal-report"]],decls:87,vars:21,consts:[[1,"mt-2","mr-3","ml-3"],["label","Terminal sale report"],[1,"pt-1","d-flex"],[1,"col-3"],["appearance","fill"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],[3,"ngModel","ngModelChange"],["picker",""],["picker1",""],["mat-button","","color","accent",2,"font-size","20px",3,"click"],["matSort","",1,"table","table-bordered","table-sm",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","total"],["mat-sort-header","commission"],["mat-sort-header","prize_value"],["mat-sort-header","ntp"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["label","Terminal barcode report"],[1,"",2,"overflow","hidden"],["matSort","",1,"table","table-bordered","table-sm","m-3",2,"border","none !important","height","50px","overflow","hidden"],["mat-sort-header","draw_time"],["mat-sort-header","ticket_taken_time"],["mat-sort-header","barcode_number"],["mat-sort-header","total_quantity"],["mat-sort-header","amount"],["mdbModal","","id","frameModalTop","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade","top",2,"overflow-y","auto"],["frame","mdbModal"],["class","modal-dialog modal-notify modal-info","role","document","style","min-width: 550px",4,"ngIf"],[1,"text-center"],["type","button",1,"btn","btn-danger",2,"min-width","87px",3,"hidden","disabled","click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],["color","info","mdbWavesEffect","",1,"waves-effect","mb-4",3,"click"],[1,"bi","bi-info-square-fill"],["role","document",1,"modal-dialog","modal-notify","modal-info",2,"min-width","550px"],[1,"modal-content"],[1,"modal-header","text-center"],[1,"modal-title","white-text","font-weight-bold"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true",1,"white-text"],[1,"modal-body"],[4,"ngIf"],[1,"d-flex","flex-row","mt-2"],["class","mr-2",3,"matBadge",4,"ngFor","ngForOf"],["class","d-flex flex-row mt-2",4,"ngFor","ngForOf"],[1,"modal-footer","justify-content-center"],[1,"mr-2",3,"matBadge"],["colspan","2","class","text-center align-middle mr-3","style","max-width: 100% !important;",4,"ngFor","ngForOf"],["colspan","2",1,"text-center","align-middle","mr-3",2,"max-width","100% !important"],["mat-raised-button","","value","bold","name","fontStyle","aria-label","Font Style",2,"font-size","larger","min-width","97% !important","padding","0px !important","min-height","40px",3,"matBadge","matBadgeHidden"]],template:function(t,e){if(1&t&&(d.TgZ(0,"mat-tab-group",0),d.TgZ(1,"mat-tab",1),d.TgZ(2,"div",2),d.TgZ(3,"div",3),d.TgZ(4,"mat-form-field",4),d.TgZ(5,"mat-label"),d._uU(6,"Start date"),d.qZA(),d.TgZ(7,"input",5),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d._UZ(8,"mat-datepicker-toggle",6),d.TgZ(9,"mat-datepicker",7,8),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"div",3),d.TgZ(12,"mat-form-field",4),d.TgZ(13,"mat-label"),d._uU(14,"End date"),d.qZA(),d.TgZ(15,"input",5),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d._UZ(16,"mat-datepicker-toggle",6),d.TgZ(17,"mat-datepicker",7,9),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(19,"button",10),d.NdJ("click",function(){return e.getTerminalSaleReport()}),d._uU(20,"Search"),d.qZA(),d.qZA(),d.TgZ(21,"table",11),d.TgZ(22,"thead"),d.TgZ(23,"tr"),d.TgZ(24,"th"),d._uU(25,"Date"),d.qZA(),d.TgZ(26,"th",12),d._uU(27,"Amount"),d.qZA(),d.TgZ(28,"th",13),d._uU(29,"Commission"),d.qZA(),d.TgZ(30,"th",14),d._uU(31,"Prize"),d.qZA(),d.TgZ(32,"th",15),d._uU(33,"NTP"),d.qZA(),d._UZ(34,"th"),d.qZA(),d.qZA(),d.TgZ(35,"tbody"),d.YNc(36,U,11,5,"tr",16),d.qZA(),d.qZA(),d.YNc(37,y,3,0,"div",17),d.qZA(),d.TgZ(38,"mat-tab",18),d.TgZ(39,"div",2),d.TgZ(40,"div",3),d.TgZ(41,"mat-form-field",4),d.TgZ(42,"mat-label"),d._uU(43,"Start date"),d.qZA(),d.TgZ(44,"input",5),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d._UZ(45,"mat-datepicker-toggle",6),d.TgZ(46,"mat-datepicker",7,8),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(48,"div",3),d.TgZ(49,"mat-form-field",4),d.TgZ(50,"mat-label"),d._uU(51,"End date"),d.qZA(),d.TgZ(52,"input",5),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d._UZ(53,"mat-datepicker-toggle",6),d.TgZ(54,"mat-datepicker",7,9),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(56,"button",10),d.NdJ("click",function(){return e.getTerminalBarcodeReport()}),d._uU(57,"Search"),d.qZA(),d.qZA(),d.TgZ(58,"div",19),d.TgZ(59,"table",20),d.TgZ(60,"thead"),d.TgZ(61,"tr"),d.TgZ(62,"th"),d._uU(63,"Sl.NO"),d.qZA(),d.TgZ(64,"th",21),d._uU(65,"Draw Time"),d.qZA(),d.TgZ(66,"th",22),d._uU(67,"Ticket Time"),d.qZA(),d.TgZ(68,"th",23),d._uU(69,"Barcode"),d.qZA(),d.TgZ(70,"th",24),d._uU(71,"Quantity"),d.qZA(),d.TgZ(72,"th",25),d._uU(73,"Amount"),d.qZA(),d.TgZ(74,"th",14),d._uU(75,"Prize"),d.qZA(),d.TgZ(76,"th"),d._uU(77,"Claim"),d.qZA(),d.TgZ(78,"th"),d._uU(79,"Cancel"),d.qZA(),d._UZ(80,"th"),d.qZA(),d.qZA(),d.TgZ(81,"tbody"),d.YNc(82,k,24,11,"tr",16),d.qZA(),d.qZA(),d.YNc(83,w,3,0,"div",17),d.qZA(),d.qZA(),d.qZA(),d.TgZ(84,"div",26,27),d.YNc(86,N,15,5,"div",28),d.qZA()),2&t){const t=d.MAs(10),a=d.MAs(18);d.xp6(7),d.Q6J("matDatepicker",t)("ngModel",e.StartDateFilter),d.xp6(1),d.Q6J("for",t),d.xp6(1),d.Q6J("ngModel",e.StartDateFilter),d.xp6(6),d.Q6J("matDatepicker",a)("ngModel",e.EndDateFilter),d.xp6(1),d.Q6J("for",a),d.xp6(1),d.Q6J("ngModel",e.EndDateFilter),d.xp6(19),d.Q6J("ngForOf",e.terminalSaleReportData),d.xp6(1),d.Q6J("ngIf",0==e.terminalSaleReportData.length),d.xp6(7),d.Q6J("matDatepicker",t)("ngModel",e.StartDateFilter),d.xp6(1),d.Q6J("for",t),d.xp6(1),d.Q6J("ngModel",e.StartDateFilter),d.xp6(6),d.Q6J("matDatepicker",a)("ngModel",e.EndDateFilter),d.xp6(1),d.Q6J("for",a),d.xp6(1),d.Q6J("ngModel",e.EndDateFilter),d.xp6(28),d.Q6J("ngForOf",e.terminalReportData),d.xp6(1),d.Q6J("ngIf",0==e.terminalReportData.length),d.xp6(3),d.Q6J("ngIf",e.barcodeDetails)}},directives:[T.SP,T.uX,A.KE,A.hX,q.Nt,_.hl,x.Fj,x.JJ,x.On,_.nW,A.R9,_.Mq,S.lW,R.YE,R.nU,i.sg,i.O5,v.oB,v.b6,D.k],styles:[""]}),t})()}];let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[r.Bz.forChild(E)],r.Bz]}),t})();var Q=a(2103),I=a(5480),L=a(5566),P=a(3738),z=a(5396),Y=a(9870),j=a(4820),W=a(2458);let $=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[i.ez,B,i.ez,Q.q,T.Nh,I.q,L.o9,P.QW,x.u5,x.UX,z.rP,R.JX,Y.aE,Y.bz,v.At,j.UU,D.g,_.FA,q.c,x.u5,W.XK,W.si]]}),t})()}}]);