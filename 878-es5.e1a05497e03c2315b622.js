!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}(self.webpackChunkaccounts=self.webpackChunkaccounts||[]).push([[878],{60878:function(e,n,i){"use strict";i.r(n),i.d(n,{TerminalReportModule:function(){return z}});var o=i(61116),l=i(33464),c=i(65724),s=i(22501),u=i.n(s),d=i(35366),p=i(55959),g=i(31225),m=i(529),h=i(47727),f=i(44019),Z=i(42693),T=i(78035),b=i(4612),A=function(){var e=function(){function e(t,n,a){r(this,e),this.http=t,this.errorService=n,this.authService=a,this.BASE_API_URL=m.N.BASE_API_URL,this.barcodeReportRecords=[],this.terminalSaleRRecords=[],this.userData=JSON.parse(localStorage.getItem("user")),this.barcodeReportRecordsSubject=new p.xQ,this.terminalSaleRecordsSubject=new p.xQ}return a(e,[{key:"terminalListListener",value:function(){return this.barcodeReportRecordsSubject.asObservable()}},{key:"terminalSaleListListener",value:function(){return this.terminalSaleRecordsSubject.asObservable()}},{key:"cancelTicket",value:function(e){var r=this;return this.http.post(this.BASE_API_URL+"/cancelTicket",{play_master_id:e}).pipe((0,h.K)(this.handleError),(0,f.b)(function(e){if(e.data){r.authService.updateUserBalance(e.point),console.log(e.point);var n=r.barcodeReportRecords.findIndex(function(t){return t.play_master_id===e.id});r.barcodeReportRecords[n].is_cancelled=1,r.barcodeReportRecordsSubject.next(t(r.barcodeReportRecords))}}))}},{key:"getTerminalReport",value:function(e,r,n){var a=this;return this.http.post(this.BASE_API_URL+"/terminal/barcodeReport",{terminalId:e,startDate:r,endDate:n}).pipe((0,h.K)(this.handleError),(0,f.b)(function(e){e.data&&(a.barcodeReportRecords=e.data,a.barcodeReportRecordsSubject.next(t(a.barcodeReportRecords)))}))}},{key:"getTerminalSaleReport",value:function(e,r,n){var a=this;return this.http.post(this.BASE_API_URL+"/terminal/terminal_sale_reports",{terminalId:e,startDate:r,endDate:n}).pipe((0,h.K)(this.handleError),(0,f.b)(function(e){e.data&&(a.terminalSaleRRecords=e.data,a.terminalSaleRecordsSubject.next(t(a.terminalSaleRRecords)))}))}},{key:"serverError",value:function(t){return t instanceof Response?(0,g._)("backend server error"):(0,g._)(0===t.status?{status:t.status,message:"Backend Server is not Working",statusText:t.statusText}:401===t.status?{status:t.status,message:"Your are not authorised",statusText:t.statusText}:t)}},{key:"handleError",value:function(t){return t.error.message.includes("1062")?(0,g._)("Record already exists"):(0,g._)(t.error.message)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(d.LFG(Z.eN),d.LFG(T.T),d.LFG(b.e))},e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),q=i(57173),S=i(13070),v=i(9550),_=i(69024),y=i(31041),R=i(84369),k=i(59241);function D(t,e){if(1&t){var r=d.EpF();d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.qZA(),d.TgZ(3,"td"),d._uU(4),d.qZA(),d.TgZ(5,"td"),d._uU(6),d.qZA(),d.TgZ(7,"td"),d._uU(8),d.qZA(),d.TgZ(9,"td"),d._uU(10),d.qZA(),d.TgZ(11,"td"),d.TgZ(12,"button",22),d.NdJ("click",function(){var t=d.CHM(r).$implicit;return d.oxw().cancelTicket(t.play_master_id)}),d._uU(13,"Cancel"),d.qZA(),d.qZA(),d.qZA()}if(2&t){var n=e.$implicit,a=d.oxw();d.xp6(2),d.Oqu(n.barcode_number),d.xp6(2),d.Oqu(n.draw_time),d.xp6(2),d.Oqu(n.total_quantity),d.xp6(2),d.Oqu(n.amount),d.xp6(2),d.Oqu(n.prize_value),d.xp6(2),d.Q6J("disabled",a.checkBtnEligibility(n))}}function U(t,e){1&t&&(d.TgZ(0,"div",23),d.TgZ(1,"h1"),d._uU(2,"No Data"),d.qZA(),d.qZA())}function x(t,e){if(1&t&&(d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.qZA(),d.TgZ(3,"td"),d._uU(4),d.qZA(),d.TgZ(5,"td"),d._uU(6),d.qZA(),d.TgZ(7,"td"),d._uU(8),d.qZA(),d.TgZ(9,"td"),d._uU(10),d.qZA(),d.TgZ(11,"td"),d._uU(12),d.qZA(),d.qZA()),2&t){var r=e.$implicit;d.xp6(2),d.Oqu(r.terminal_pin),d.xp6(2),d.Oqu(r.stokiest_name),d.xp6(2),d.Oqu(r.total),d.xp6(2),d.Oqu(r.commission),d.xp6(2),d.Oqu(r.prize_value),d.xp6(2),d.Oqu(r.ntp.toFixed(2))}}function M(t,e){1&t&&(d.TgZ(0,"div",23),d.TgZ(1,"h1"),d._uU(2,"No Data"),d.qZA(),d.qZA())}var J,w,F=[{path:"",canActivate:[c.v],component:(J=function(){function t(e,n){var a=this;r(this,t),this.renderer=e,this.terminalReportService=n,this.thisYear=(new Date).getFullYear(),this.thisMonth=(new Date).getMonth(),this.thisDay=(new Date).getDate(),this.startDate=new Date(this.thisYear,this.thisMonth,this.thisDay),this.StartDateFilter=this.startDate,this.EndDateFilter=this.startDate,this.pipe=new o.uU("en-US"),this.renderer.setStyle(document.body,"background-image","none"),this.terminalReportService.terminalListListener().subscribe(function(t){a.terminalReportData=t,console.log(a.terminalReportData)}),this.terminalReportService.terminalSaleListListener().subscribe(function(t){a.terminalSaleReportData=t}),this.getTerminalBarcodeReport(),this.getTerminalSaleReport()}return a(t,[{key:"ngOnInit",value:function(){}},{key:"checkBtnEligibility",value:function(t){return 1==t.is_cancelled||0==t.is_cancelable}},{key:"cancelTicket",value:function(t){var e=this;u().fire({title:"Confirm Cancel ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, confirm"}).then(function(r){r.isConfirmed?(u().fire({title:"Please Wait !",html:"Confirming cancel",allowOutsideClick:!1,didOpen:function(){u().showLoading()}}),e.terminalReportService.cancelTicket(t).subscribe(function(t){t.data?(u().hideLoading(),u().fire({icon:"success",title:"Cancelled",showConfirmButton:!1,timer:1500})):u().fire({icon:"error",title:"Some error occurred",showConfirmButton:!1,timer:2e3})})):r.isDenied&&u().fire("Changes are not saved","","info")})}},{key:"getTerminalBarcodeReport",value:function(){u().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:function(){u().showLoading()}});var t=JSON.parse(localStorage.getItem("user")),e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalReport(t.userId,e,r).subscribe(function(t){t.data&&u().close()})}},{key:"getTerminalSaleReport",value:function(){u().fire({title:"Please Wait !",html:"loading ...",allowOutsideClick:!1,didOpen:function(){u().showLoading()}});var t=JSON.parse(localStorage.getItem("user")),e=this.pipe.transform(this.StartDateFilter,"yyyy-MM-dd"),r=this.pipe.transform(this.EndDateFilter,"yyyy-MM-dd");this.terminalReportService.getTerminalSaleReport(t.userId,e,r).subscribe(function(t){t.data&&u().close()})}}]),t}(),J.\u0275fac=function(t){return new(t||J)(d.Y36(d.Qsj),d.Y36(A))},J.\u0275cmp=d.Xpm({type:J,selectors:[["app-terminal-report"]],decls:80,vars:20,consts:[[1,"mt-2","mr-3","ml-3"],["label","Terminal barcode report"],[1,"pt-1","d-flex"],[1,"col-3"],["appearance","fill"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],[3,"ngModel","ngModelChange"],["picker",""],["picker1",""],["mat-button","","color","accent",2,"font-size","20px",3,"click"],[1,""],["matSort","",1,"table","table-bordered","table-sm","m-3",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","terminal_pin"],["mat-sort-header","total"],["mat-sort-header","prize_value"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["label","Terminal sale report"],["matSort","",1,"table","table-bordered","table-sm",2,"border","none !important","height","50px","overflow","scroll"],["mat-sort-header","commission"],["mat-sort-header","ntp"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"text-center"]],template:function(t,e){if(1&t&&(d.TgZ(0,"mat-tab-group",0),d.TgZ(1,"mat-tab",1),d.TgZ(2,"div",2),d.TgZ(3,"div",3),d.TgZ(4,"mat-form-field",4),d.TgZ(5,"mat-label"),d._uU(6,"Start date"),d.qZA(),d.TgZ(7,"input",5),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d._UZ(8,"mat-datepicker-toggle",6),d.TgZ(9,"mat-datepicker",7,8),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"div",3),d.TgZ(12,"mat-form-field",4),d.TgZ(13,"mat-label"),d._uU(14,"End date"),d.qZA(),d.TgZ(15,"input",5),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d._UZ(16,"mat-datepicker-toggle",6),d.TgZ(17,"mat-datepicker",7,9),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(19,"button",10),d.NdJ("click",function(){return e.getTerminalBarcodeReport()}),d._uU(20,"Search"),d.qZA(),d.qZA(),d.TgZ(21,"div",11),d.TgZ(22,"table",12),d.TgZ(23,"thead"),d.TgZ(24,"tr"),d.TgZ(25,"th",13),d._uU(26,"Baarcode"),d.qZA(),d.TgZ(27,"th",13),d._uU(28,"Draw Time"),d.qZA(),d.TgZ(29,"th",13),d._uU(30,"Quantity"),d.qZA(),d.TgZ(31,"th",14),d._uU(32,"Amount"),d.qZA(),d.TgZ(33,"th",15),d._uU(34,"Prize"),d.qZA(),d.TgZ(35,"th",15),d._uU(36,"Cancel"),d.qZA(),d._UZ(37,"th"),d.qZA(),d.qZA(),d.TgZ(38,"tbody"),d.YNc(39,D,14,6,"tr",16),d.qZA(),d.qZA(),d.YNc(40,U,3,0,"div",17),d.qZA(),d.qZA(),d.TgZ(41,"mat-tab",18),d.TgZ(42,"div",2),d.TgZ(43,"div",3),d.TgZ(44,"mat-form-field",4),d.TgZ(45,"mat-label"),d._uU(46,"Start date"),d.qZA(),d.TgZ(47,"input",5),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d._UZ(48,"mat-datepicker-toggle",6),d.TgZ(49,"mat-datepicker",7,8),d.NdJ("ngModelChange",function(t){return e.StartDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(51,"div",3),d.TgZ(52,"mat-form-field",4),d.TgZ(53,"mat-label"),d._uU(54,"End date"),d.qZA(),d.TgZ(55,"input",5),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d._UZ(56,"mat-datepicker-toggle",6),d.TgZ(57,"mat-datepicker",7,9),d.NdJ("ngModelChange",function(t){return e.EndDateFilter=t}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(59,"button",10),d.NdJ("click",function(){return e.getTerminalSaleReport()}),d._uU(60,"Search"),d.qZA(),d.qZA(),d.TgZ(61,"table",19),d.TgZ(62,"thead"),d.TgZ(63,"tr"),d.TgZ(64,"th"),d._uU(65,"Terminal Id"),d.qZA(),d.TgZ(66,"th",13),d._uU(67,"Stokiest Name"),d.qZA(),d.TgZ(68,"th",14),d._uU(69,"Total"),d.qZA(),d.TgZ(70,"th",20),d._uU(71,"Commission"),d.qZA(),d.TgZ(72,"th",15),d._uU(73,"Prize"),d.qZA(),d.TgZ(74,"th",21),d._uU(75,"NTP"),d.qZA(),d._UZ(76,"th"),d.qZA(),d.qZA(),d.TgZ(77,"tbody"),d.YNc(78,x,13,6,"tr",16),d.qZA(),d.qZA(),d.YNc(79,M,3,0,"div",17),d.qZA(),d.qZA()),2&t){var r=d.MAs(10),n=d.MAs(18);d.xp6(7),d.Q6J("matDatepicker",r)("ngModel",e.StartDateFilter),d.xp6(1),d.Q6J("for",r),d.xp6(1),d.Q6J("ngModel",e.StartDateFilter),d.xp6(6),d.Q6J("matDatepicker",n)("ngModel",e.EndDateFilter),d.xp6(1),d.Q6J("for",n),d.xp6(1),d.Q6J("ngModel",e.EndDateFilter),d.xp6(22),d.Q6J("ngForOf",e.terminalReportData),d.xp6(1),d.Q6J("ngIf",0==e.terminalReportData.length),d.xp6(7),d.Q6J("matDatepicker",r)("ngModel",e.StartDateFilter),d.xp6(1),d.Q6J("for",r),d.xp6(1),d.Q6J("ngModel",e.StartDateFilter),d.xp6(6),d.Q6J("matDatepicker",n)("ngModel",e.EndDateFilter),d.xp6(1),d.Q6J("for",n),d.xp6(1),d.Q6J("ngModel",e.EndDateFilter),d.xp6(21),d.Q6J("ngForOf",e.terminalSaleReportData),d.xp6(1),d.Q6J("ngIf",0==e.terminalSaleReportData.length)}},directives:[q.SP,q.uX,S.KE,S.hX,v.Nt,_.hl,y.Fj,y.JJ,y.On,_.nW,S.R9,_.Mq,R.lW,k.YE,k.nU,o.sg,o.O5],styles:[""]}),J)}],C=function(){var t=function t(){r(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[l.Bz.forChild(F)],l.Bz]}),t}(),E=i(52030),O=i(1887),N=i(77154),I=i(22797),Q=i(79572),B=i(97624),L=i(48158),j=i(4333),P=i(47217),Y=i(87064),z=((w=function t(){r(this,t)}).\u0275fac=function(t){return new(t||w)},w.\u0275mod=d.oAB({type:w}),w.\u0275inj=d.cJS({imports:[[o.ez,C,o.ez,E.q,q.Nh,O.q,N.o9,I.QW,y.u5,y.UX,Q.rP,k.JX,B.aE,B.bz,L.At,j.UU,P.g,_.FA,v.c,y.u5,Y.XK,Y.si]]}),w)}}])}();